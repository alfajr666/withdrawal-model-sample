<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquidity Sentinel | Exchange Stress Testing</title>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap"
        rel="stylesheet" />
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="dark-theme">
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand">
                <div class="logo">◈</div>
                <div class="brand-text">
                    <h1>Liquidity Sentinel</h1>
                    <p>Stress Testing · Synthetic Demo</p>
                </div>
            </div>

            <nav class="nav-links">
                <a href="#status" class="nav-item active" data-section="status">
                    <span class="icon">⊕</span> Operational Status
                </a>
                <a href="#withdrawal" class="nav-item" data-section="withdrawal">
                    <span class="icon">◉</span> Withdrawal Risk
                </a>
                <a href="#solvency" class="nav-item" data-section="solvency">
                    <span class="icon">≡</span> Solvency
                </a>
                <a href="#reserve" class="nav-item" data-section="reserve">
                    <span class="icon">⊛</span> Reserve Policy
                </a>
            </nav>

            <div class="sidebar-footer">
                <p>Designed for Treasury Professionals</p>
                <div class="author">
                    <span class="label">Author</span>
                    <span class="name">Gilang Fajar</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-bar">
                <div class="section-title">
                    <h2 id="current-section-name">Operational Status</h2>
                </div>
                <div class="top-bar-right">
                    <div class="live-status">
                        <span class="status-dot pulse"></span> Synthetic Engine Active
                    </div>
                    <div class="currency-toggle-wrap">
                        <button id="toggle-currency" class="currency-btn">
                            <span id="currency-label">IDR</span>
                            <span class="fx-rate-tooltip">15,900</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Section 0: Operational Status -->
            <section id="status" class="content-section active">

                <!-- KPI Stats (Merged from Overview) -->
                <div class="stat-grid">
                    <div class="stat-card kpi">
                        <span class="card-label kpi-label">Total Fiat Liabilities</span>
                        <div class="card-value kpi-value" id="stat-total-fiat">$0.00B</div>
                        <span class="card-subtitle kpi-sub">Synthetic exchange</span>
                    </div>
                    <div class="stat-card kpi">
                        <span class="card-label kpi-label">Total AUM</span>
                        <div class="card-value kpi-value" id="stat-total-aum">$0.00B</div>
                        <span class="card-subtitle kpi-sub">Incl. crypto assets</span>
                    </div>
                    <div class="stat-card kpi">
                        <span class="card-label kpi-label">Open Interest</span>
                        <div class="card-value kpi-value" id="stat-oi">$0.00B</div>
                        <span class="card-subtitle kpi-sub">1.5× AUM · perps + CFD</span>
                    </div>
                    <div class="stat-card kpi">
                        <span class="card-label kpi-label">Insurance Fund</span>
                        <div class="card-value kpi-value" id="stat-if">$0.0M</div>
                        <span class="card-subtitle kpi-sub">0.5% of AUM · current</span>
                    </div>
                </div>

                <!-- Active Scenario Banner -->
                <div class="status-banner" id="status-banner">
                    <div class="status-banner-left">
                        <div class="status-banner-label">ACTIVE SCENARIO</div>
                        <div class="status-banner-value" id="status-scenario-name">—</div>
                    </div>
                    <div class="status-banner-right">
                        <div class="status-banner-label">WINDOW</div>
                        <div class="status-banner-time" id="status-window">FRI 17:00 → MON 09:00</div>
                        <div class="status-banner-sub">64 hrs · Bank rails offline</div>
                    </div>
                </div>

                <!-- Row 1: Fiat Position + Insurance Fund -->
                <div class="status-grid">

                    <div class="status-card" id="card-fiat">
                        <div class="card-label">Fiat Reserve Position</div>
                        <span class="status-verdict" id="verdict-fiat">—</span>
                        <div class="status-primary" id="fiat-gap">—</div>
                        <div class="status-sub">Shortfall vs. required Layer 1 reserve</div>
                        <div class="status-breakdown">
                            <div class="breakdown-row">
                                <span class="bk-key">Current reserve (gateway)</span>
                                <span class="bk-val" id="fiat-current">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Required — Layer 1 (VaR)</span>
                                <span class="bk-val amber" id="fiat-req-l1">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Required — Layer 2 (P95)</span>
                                <span class="bk-val amber" id="fiat-req-l2">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Gap to Layer 1 minimum</span>
                                <span class="bk-val" id="fiat-gap-label">—</span>
                            </div>
                        </div>
                    </div>

                    <div class="status-card" id="card-insurance">
                        <div class="card-label">Insurance Fund Position</div>
                        <span class="status-verdict" id="verdict-insurance">—</span>
                        <div class="status-primary" id="if-gap">—</div>
                        <div class="status-sub">Projected shortfall under active scenario</div>
                        <div class="status-breakdown">
                            <div class="breakdown-row">
                                <span class="bk-key">Current IF balance</span>
                                <span class="bk-val" id="if-current">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Expected drawdown (P99)</span>
                                <span class="bk-val amber" id="if-drawdown">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">P(fund exhaustion)</span>
                                <span class="bk-val" id="if-prob-exhaustion">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Expected clawback</span>
                                <span class="bk-val" id="if-clawback">—</span>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Row 2: Time Buffer + Weekend Readiness -->
                <div class="status-grid">

                    <div class="status-card" id="card-time">
                        <div class="card-label">Time to Reserve Exhaustion</div>
                        <span class="status-verdict" id="verdict-time">—</span>
                        <div class="status-time-body">
                            <div class="status-time-main">
                                <div class="status-primary" id="time-hours">—</div>
                                <div class="status-sub">At current withdrawal velocity</div>
                            </div>
                            <div class="status-time-bar-wrap">
                                <div class="time-bar-label">
                                    <span>0 hrs</span><span>64 hrs</span>
                                </div>
                                <div class="time-bar-track">
                                    <div class="time-bar-fill" id="time-bar-fill"></div>
                                </div>
                                <div class="time-bar-label" style="margin-top:5px;">
                                    <span id="time-bar-label-left">—</span>
                                    <span>End of weekend</span>
                                </div>
                            </div>
                        </div>
                        <div class="status-breakdown">
                            <div class="breakdown-row">
                                <span class="bk-key">Institutional lead detected</span>
                                <span class="bk-val" id="time-inst-lead">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Current withdrawal velocity</span>
                                <span class="bk-val" id="time-velocity">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Retail panic onset (est.)</span>
                                <span class="bk-val amber" id="time-retail-onset">—</span>
                            </div>
                        </div>
                    </div>

                    <div class="status-card" id="card-readiness">
                        <div class="card-label">Weekend Readiness</div>
                        <span class="status-verdict" id="verdict-readiness">—</span>
                        <div class="status-sub" style="margin-bottom:10px;">Total capital gap</div>
                        <div class="status-primary" id="readiness-gap">—</div>
                        <div class="status-sub">Fiat shortfall + IF gap under active scenario P99</div>
                        <div class="status-breakdown">
                            <div class="breakdown-row">
                                <span class="bk-key">Fiat reserve gap</span>
                                <span class="bk-val" id="readiness-fiat-gap">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Insurance fund gap</span>
                                <span class="bk-val" id="readiness-if-gap">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Proprietary capital buffer</span>
                                <span class="bk-val green" id="readiness-prop">—</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="bk-key">Net position</span>
                                <span class="bk-val" id="readiness-net">—</span>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Required Action Row -->
                <div class="action-divider-label">Required Action</div>
                <div class="action-row" id="action-row">
                    <div class="action-icon">⚠</div>
                    <div class="action-text">
                        <div class="action-title" id="action-title">—</div>
                        <div class="action-desc" id="action-desc">—</div>
                    </div>
                    <div class="action-badge" id="action-badge">—</div>
                </div>

            </section>


            <!-- Section 2: Withdrawal Risk -->
            <section id="withdrawal" class="content-section">
                <div class="stat-grid">
                    <div class="stat-card">
                        <span class="card-label">Normal P99 Withdrawal</span>
                        <div class="card-value highlight" id="wd-p99-normal">$0M</div>
                    </div>
                    <div class="stat-card">
                        <span class="card-label">Mild P99 Withdrawal</span>
                        <div class="card-value highlight" id="wd-p99-mild">$0M</div>
                    </div>
                    <div class="stat-card">
                        <span class="card-label">Severe P99 Withdrawal</span>
                        <div class="card-value highlight" id="wd-p99-severe">$0M</div>
                    </div>
                    <div class="stat-card">
                        <span class="card-label">Institutional Lead Time</span>
                        <div class="card-value highlight">~6-8 hours</div>
                    </div>
                </div>

                <div class="chart-row flex-col">
                    <div class="chart-container full">
                        <h3>Withdrawal Distribution by Scenario</h3>
                        <div class="chart-legend">
                            <span class="legend-item"><span class="dot normal"></span> Normal</span>
                            <span class="legend-item"><span class="dot mild"></span> Mild</span>
                            <span class="legend-item"><span class="dot severe"></span> Severe</span>
                        </div>
                        <canvas id="chart-withdrawal-dist"></canvas>
                    </div>
                    <div class="chart-container full">
                        <h3>64-Hour Cumulative Withdrawal Paths</h3>
                        <canvas id="chart-withdrawal-paths"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>Scenario Comparison Matrix</h3>
                    <table id="table-withdrawal-stats">
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Trigger</th>
                                <th>Daily Rate</th>
                                <th>Mean Withdrawal</th>
                                <th>P95</th>
                                <th>P99</th>
                                <th>CVaR 99%</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="callout amber show-border">
                    <p><strong>Key Insight:</strong> Institutional withdrawals lead retail by ~6-8 hours in severe
                        stress. Poisson arrival rate rises 12× from normal to severe — the primary driver of tail risk.
                    </p>
                </div>
            </section>

            <!-- Section 3: Solvency -->
            <section id="solvency" class="content-section">
                <div class="chart-row">
                    <div class="chart-container full">
                        <h3>Stressed Balance Sheet Waterfall (Severe Scenario)</h3>
                        <canvas id="chart-solvency-waterfall"></canvas>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>VaR Method Comparison</h3>
                    <table id="table-var-comparison">
                        <thead>
                            <tr>
                                <th>Method</th>
                                <th>VaR 95%</th>
                                <th>VaR 99%</th>
                                <th>CVaR 99%</th>
                                <th>% of AUM</th>
                                <th>Note</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="chart-row">
                    <div class="chart-container full">
                        <h3>Insurance Fund Drawdown Distribution (Severe)</h3>
                        <canvas id="chart-if-drawdown"></canvas>
                    </div>
                </div>

                <div class="callout amber show-border">
                    <p><strong>Note:</strong> EWMA effective sample size = <span id="val-ess">0</span> days. The model
                        is almost entirely pricing current volatility, not history — it will give false comfort in a
                        calm market.</p>
                </div>
            </section>

            <!-- Section 4: Reserve Policy -->
            <section id="reserve" class="content-section">
                <div class="data-table-container">
                    <h3>Three-Layer Reserve Allocation (Recommendation)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Layer</th>
                                <th>Purpose</th>
                                <th>Instrument</th>
                                <th>Size</th>
                                <th>Annual Cost</th>
                                <th>Liquidity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Layer 1 — Instant</td>
                                <td>Normal withdrawals</td>
                                <td>Fiat in payment gateway</td>
                                <td id="res-t1-size">$0M</td>
                                <td id="res-t1-cost">$0M</td>
                                <td>Zero delay</td>
                            </tr>
                            <tr>
                                <td>Layer 2 — Fast</td>
                                <td>Institutional jump phase</td>
                                <td>Stablecoins, Overnight Repo</td>
                                <td id="res-t2-size">$0M</td>
                                <td id="res-t2-cost">$0M</td>
                                <td>~Hours</td>
                            </tr>
                            <tr>
                                <td>Layer 3 — Liquid</td>
                                <td>Crisis backstop</td>
                                <td>T-bills, Money Market</td>
                                <td id="res-t3-size">$0M</td>
                                <td>—</td>
                                <td>1-2 days</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="policy-card">
                    <div class="policy-header">RECOMMENDED MINIMUM RESERVE</div>
                    <div class="policy-grid">
                        <div class="policy-item">
                            <span class="p-label">Tier 1 — Operating (VaR)</span>
                            <span class="p-value" id="policy-t1">$0M</span>
                        </div>
                        <div class="policy-item">
                            <span class="p-label">Tier 2 — Crisis (Scenario)</span>
                            <span class="p-value" id="policy-t2">$0M</span>
                        </div>
                        <div class="policy-item">
                            <span class="p-label">P(shortfall | Normal)</span>
                            <span class="p-value" id="policy-p-normal">0.00%</span>
                        </div>
                        <div class="policy-item">
                            <span class="p-label">P(shortfall | Severe)</span>
                            <span class="p-value highlight red" id="policy-p-severe">0.00%</span>
                        </div>
                    </div>
                    <div class="policy-footer">
                        Shortfall probability at Tier 1 reserve level. Severe scenarios require Tier 2 buffers.
                    </div>
                </div>

                <div class="chart-row">
                    <div class="chart-container full">
                        <h3>Reserve Cost Curve (Newsvendor Optimization)</h3>
                        <canvas id="chart-cost-curve"></canvas>
                    </div>
                </div>

                <div class="callout amber show-border">
                    <p><strong>Warning:</strong> Stablecoins are operationally near-cash but systemically correlated
                        with crypto stress. Layer 2 should be predominantly money market / T-bills, not
                        stablecoin-heavy.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Data and App Logic -->
    <script src="data.js"></script>
    <script src="charts.js"></script>
    <script src="app.js"></script>
</body>

</html>